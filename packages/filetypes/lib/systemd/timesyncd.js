// Generated by CoffeeScript 2.4.0
// # timesyncd.coffee.md

// * `rootdir` (string)
//   Path to the mount point corresponding to the root directory, optional.
// * `content` (array)
//   Fields that accepts space-separated values should be passed as array if they
//   contains more than one element. Runs `systemctl daemon-reload && systemctl
//   restart systemd-timesyncd` by default if target was modified.
// * `reload` (boolean, optional, null)
//   Defaults to true. If set to true the following command will be executed
//   `systemctl daemon-reload && systemctl restart systemd-timesyncd` after having
//   wrote the configuration file.
// * `target` (string)
//   File to write, defaults to
//   "/usr/lib/systemd/timesyncd.conf.d/timesyncd.conf".
// * `merge` (boolean, optional, null)
//   Defaults to false. If set to true, the content of `target` wont be overridden
//   but merged with `content`.

// ## Example

// ```javascript
// nikita = require("nikita")

// nikita.file.types.systemd.timesyncd({
//   target: "/etc/systemd/timesyncd.conf",
//   rootdir: "/mnt",
//   content:
//     NTP: ["ntp.domain.com", "ntp.domain2.com", "ntp.domain3.com"]
//     FallbackNTP: "fallback.domain.com"
// })

// nikita.file.types.systemd.timesyncd({
//   content:
//     NTP: "0.arch.pool.ntp.org"
//     RootDistanceMaxSec: 5
//   merge: true
// })
// ```
var path;

module.exports = function({options}) {
  this.log({
    message: "Entering file.types.timesyncd",
    level: "DEBUG",
    module: "nikita/lib/file/types/systemd"
  });
  // Options
  if (options.target == null) {
    options.target = "/usr/lib/systemd/timesyncd.conf.d/timesyncd.conf";
  }
  if (options.rootdir) {
    options.target = `${path.join(options.rootdir, options.target)}`;
  }
  if (options.generate == null) {
    options.generate = null;
  }
  if (Array.isArray(options.content.NTP)) {
    options.content.NTP = options.content.NTP.join(" ");
  }
  if (Array.isArray(options.content.FallbackNTP)) {
    options.content.FallbackNTP = options.content.FallbackNTP.join(" ");
  }
  options.content = {
    Time: options.content
  };
  // Write configuration
  this.file.ini({
    separator: "=",
    target: options.target,
    content: options.content,
    merge: options.merge
  });
  return this.system.execute({
    if: function() {
      if (options.reload != null) {
        return options.reload;
      } else {
        return this.status(-1);
      }
    },
    sudo: true,
    cmd: "systemctl daemon-reload\nsystemctl restart systemd-timesyncd",
    trap: true
  });
};

// ## Dependencies
path = require("path");
