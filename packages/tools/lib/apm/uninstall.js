// Generated by CoffeeScript 2.5.1
  // # `nikita.tools.apm`

// Remove one or more apm packages.

// ## Options

// * `name` (string|array, required)
  //   Name of the package(s).

// ## Source code
var string, uninstall,
  indexOf = [].indexOf;

uninstall = function({options}) {
  var installed;
  if (options.argument != null) {
    options.name = options.argument;
  }
  if (typeof options.name === 'string') {
    options.name = [options.name];
  }
  options.name = options.name.map(function(pkg) {
    return pkg.toLowerCase();
  });
  installed = [];
  this.system.execute({
    cmd: "apm list --installed --json"
  }, function(err, {stdout}) {
    var pkgs;
    if (err) {
      throw err;
    }
    pkgs = JSON.parse(stdout);
    pkgs = pkgs.user.map(function(pkg) {
      return pkg.name.toLowerCase();
    });
    return installed = pkgs;
  });
  return this.call(function() {
    var to_uninstall;
    to_uninstall = options.name.filter(function(pkg) {
      return indexOf.call(installed, pkg) >= 0;
    });
    return this.system.execute({
      cmd: `apm uninstall ${options.name.join(' ')}`,
      if: to_uninstall.length
    }, (err) => {
      return this.log({
        message: `APM Uninstalled Packages: ${options.name.join(', ')}`
      });
    });
  });
};

// ## Exports
module.exports = uninstall;

// ## Dependencies
string = require('@nikitajs/core/lib/misc/string');
