// Generated by CoffeeScript 2.5.1
var templated;

templated = require('self-templated');

module.exports = function() {
  return {
    module: '@nikitajs/engine/src/plugins/template',
    hooks: {
      'nikita:session:normalize': function(action) {
        var base;
        // Move property from action to metadata
        if (action.hasOwnProperty('templated')) {
          action.metadata.templated = action.templated;
          delete action.templated;
        }
        return (base = action.metadata).templated != null ? base.templated : base.templated = true;
      },
      'nikita:session:action': function(action, handler) {
        return function() {
          var ref;
          if (action.metadata.templated !== false && ((ref = action.parent) != null ? ref.metadata.templated : void 0) !== false) {
            action = templated(action, {
              compile: false,
              partial: {
                metadata: true,
                config: true
              }
            });
          }
          return handler.call(null, action);
        };
      }
    }
  };
};
