// Generated by CoffeeScript 2.5.1
/*
The `global` plugin look it the parent tree for a "global" configuration. If
found, it will merge its value with the current configuration.

The functionnality is used to provide global default settings to a group of
actions. Consider for exemple the Docker actions. Each action has specific
configuration properties but there are also some properties which benefits
from being shared by all the Docker actions such as the adress of the Docker
daemon if it is not run locally.

*/
module.exports = function() {
  return {
    module: '@nikitajs/engine/src/plugins/global',
    require: ['@nikitajs/engine/src/plugins/tools_find'],
    hooks: {
      'nikita:session:action': {
        handler: async function(action) {
          var base, global, k, ref, v;
          global = action.metadata.global;
          if (!global) {
            return action;
          }
          action.config[global] = (await action.tools.find(function({config}) {
            return config[global];
          }));
          ref = action.config[global];
          for (k in ref) {
            v = ref[k];
            if ((base = action.config)[k] == null) {
              base[k] = v;
            }
          }
          delete action.config[global];
          return action;
        }
      }
    }
  };
};
